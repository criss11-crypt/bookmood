<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Bookflix y Relájate</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Coincidir apariencia con el login */
        .login-form-container { align-items:center; justify-content:center; min-height:100vh; padding:1rem; }
        .login-form-container form { width:100%; max-width:480px; background:#fff; padding:1.6rem; border-radius:8px; box-shadow:0 6px 20px rgba(0,0,0,0.08); color:#222; }
        .form-group { margin-bottom:0.85rem; display:block; }
        .form-group label { display:block; margin-bottom:0.35rem; font-weight:600; }
        .password-wrapper { position:relative; }
        .toggle-password { position:absolute; right:8px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; color:#333; padding:6px; font-size:1rem; }
        .error { color:#b00020; font-size:0.9rem; margin-top:0.25rem; display:none; }
        .error.visible { display:block; }
        #close-register-btn { position:absolute; right:16px; top:16px; cursor:pointer; }
        .btn { background:#111827; color:#fff; padding:.6rem 1rem; border-radius:6px; border:none; cursor:pointer; }
        .small { font-size:0.9rem; color:#444; }
    </style>
</head>

<body>

    <div class="login-form-container active" style="display:flex;">

        <div id="close-register-btn" class="fas fa-times" role="button" tabindex="0" aria-label="Cerrar formulario"></div>

        <form id="register-form" action="#" method="POST" novalidate>
            <h3>crear cuenta</h3>

            <div class="form-group">
                <label for="name">nombre completo</label>
                <input id="name" name="name" type="text" class="box" placeholder="tu nombre completo" required aria-required="true" autocomplete="name">
                <div id="name-error" class="error" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label for="email">correo electrónico</label>
                <input id="email" name="email" type="email" class="box" placeholder="tu correo" required aria-required="true" autocomplete="email">
                <div id="email-error" class="error" aria-live="polite"></div>
            </div>

            <div class="form-group password-wrapper">
                <label for="password">contraseña</label>
                <input id="password" name="password" type="password" class="box" placeholder="crea una contraseña" required aria-required="true" autocomplete="new-password">
                <button type="button" class="toggle-password" aria-label="Mostrar contraseña"> <i class="fas fa-eye"></i> </button>
                <div id="password-error" class="error" aria-live="polite"></div>
            </div>

            <div class="form-group password-wrapper">
                <label for="password2">confirmar contraseña</label>
                <input id="password2" name="password2" type="password" class="box" placeholder="repite la contraseña" required aria-required="true" autocomplete="new-password">
                <button type="button" class="toggle-password-2" aria-label="Mostrar contraseña"> <i class="fas fa-eye"></i> </button>
                <div id="password2-error" class="error" aria-live="polite"></div>
            </div>

            <div class="checkbox">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms" class="small">Acepto los <a href="#">términos y condiciones</a></label>
            </div>

            <div style="margin-top:1rem;">
                <input type="submit" value="crear cuenta" class="btn">
            </div>

            <p style="margin-top:.6rem;" class="small">¿ya tienes cuenta? <a href="login.html">inicia sesión</a></p>

            <div id="form-message" class="error" aria-live="polite"></div>
        </form>

    </div>

    <script>
        (function(){
            const closeBtn = document.getElementById('close-register-btn');
            const container = document.querySelector('.login-form-container');
            const toggle = document.querySelector('.toggle-password');
            const toggle2 = document.querySelector('.toggle-password-2');
            const password = document.getElementById('password');
            const password2 = document.getElementById('password2');
            const form = document.getElementById('register-form');
            const nameInput = document.getElementById('name');
            const email = document.getElementById('email');

            // Regex para la contraseña: Mínimo 8, al menos 1 mayúscula, 1 minúscula, 1 número y 1 carácter especial de los permitidos.
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[.,;:-_])[A-Za-z\d.,;:-_]{8,}$/;

            function showError(el, msg){ el.textContent = msg; el.classList.add('visible'); }
            function clearError(el){ el.textContent = ''; el.classList.remove('visible'); }

            closeBtn.addEventListener('click', ()=>{ container.style.display = 'none'; });
            closeBtn.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') container.style.display = 'none'; });

            toggle && toggle.addEventListener('click', ()=>{
                const t = password.type === 'password' ? 'text' : 'password';
                password.type = t;
                toggle.innerHTML = t === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });

            toggle2 && toggle2.addEventListener('click', ()=>{
                const t = password2.type === 'password' ? 'text' : 'password';
                password2.type = t;
                toggle2.innerHTML = t === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });

            form.addEventListener('submit', function(e){
                e.preventDefault();

                // limpiar errores
                ['name-error','email-error','password-error','password2-error','form-message'].forEach(id=>{
                    const el = document.getElementById(id); if(el) el.textContent=''; el && el.classList.remove('visible');
                });

                let valid = true;
                const passwordErrorEl = document.getElementById('password-error');
                const password2ErrorEl = document.getElementById('password2-error');

                if(nameInput.value.trim().length < 2){ showError(document.getElementById('name-error'),'Introduce tu nombre completo.'); valid=false; }

                if(!email.checkValidity()){ showError(document.getElementById('email-error'),'Introduce un correo válido.'); valid=false; }

                // Validación de contraseña con Regex
                if(!passwordRegex.test(password.value)){
                    showError(passwordErrorEl,'La contraseña debe tener al menos 8 caracteres, incluir letras minúsculas, mayúsculas, un número y uno de estos caracteres especiales: . , ; : - _');
                    valid=false;
                } else if(password.value !== password2.value){
                    showError(password2ErrorEl,'Las contraseñas no coinciden.');
                    valid=false;
                }

                // La validación de coincidencia de contraseña solo ocurre si ambas contraseñas tienen formato válido
                if(passwordRegex.test(password.value) && password.value !== password2.value){
                    showError(password2ErrorEl,'Las contraseñas no coinciden.'); valid=false;
                }

                if(!document.getElementById('terms').checked){
                    showError(document.getElementById('form-message'),'Debes aceptar los términos y condiciones.'); valid=false;
                }

                if(!valid) return;

                const formMessage = document.getElementById('form-message');
                formMessage.textContent = 'Creando cuenta...'; formMessage.classList.add('visible');

                // Simulación de petición al servidor
                setTimeout(()=>{
                    // En caso de éxito, redirigir al login (conexión)
                    window.location.href = 'login.html';
                },700);
            });
        })();
    </script>

</body>

</html>